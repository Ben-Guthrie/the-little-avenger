[gd_scene load_steps=18 format=4 uid="uid://davabj3wqbpti"]

[ext_resource type="Script" path="res://levels/level_1.gd" id="1_8tldk"]
[ext_resource type="TileSet" uid="uid://bpqj3wfubuunh" path="res://assets/town_tileset.tres" id="1_ccbd7"]
[ext_resource type="PackedScene" uid="uid://dhsl75ittm0wq" path="res://environment/sign.tscn" id="2_wjbil"]
[ext_resource type="PackedScene" uid="uid://cphxxij4w7kuv" path="res://triggers/dialogue_trigger.tscn" id="3_7si14"]
[ext_resource type="PackedScene" uid="uid://cvowmnfl8p3x7" path="res://environment/bush.tscn" id="3_lkic7"]
[ext_resource type="PackedScene" uid="uid://idac6wrpasgv" path="res://environment/wheelbarrow.tscn" id="4_74al4"]
[ext_resource type="PackedScene" uid="uid://cqx28vp8kokba" path="res://characters/timmy.tscn" id="4_475vb"]
[ext_resource type="Resource" uid="uid://cdp3n4o24gxi" path="res://globals/dialogue/intro.dialogue" id="4_owc7f"]
[ext_resource type="Shader" path="res://shaders/haunt-outline.gdshader" id="7_2ye2u"]
[ext_resource type="PackedScene" uid="uid://1m2umsuy8oo5" path="res://triggers/trigger.tscn" id="7_k4aph"]
[ext_resource type="PackedScene" uid="uid://cycr7ijppuaug" path="res://characters/ghost.tscn" id="8_8j1tp"]
[ext_resource type="Texture2D" uid="uid://fn7hcj6iq0jh" path="res://shaders/color_gradient_texture_1d.tres" id="8_mo3g1"]
[ext_resource type="Texture2D" uid="uid://caqsdsty08tfr" path="res://shaders/vertical_gradient_texture_1d.tres" id="9_pa2q0"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_vqgqp"]
shader = ExtResource("7_2ye2u")
shader_parameter/size_effect = 12.0
shader_parameter/speed = 1.2
shader_parameter/highlight_strength = 0.5
shader_parameter/color_mode_toggle = true
shader_parameter/is_horizontal = false
shader_parameter/pause_duration = 0.2
shader_parameter/texture_size = Vector2(16, 16)
shader_parameter/onoff = false
shader_parameter/vertical_gradient = ExtResource("9_pa2q0")
shader_parameter/color_gradient = ExtResource("8_mo3g1")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rw3kd"]
shader = ExtResource("7_2ye2u")
shader_parameter/size_effect = 12.0
shader_parameter/speed = 1.2
shader_parameter/highlight_strength = 0.5
shader_parameter/color_mode_toggle = true
shader_parameter/is_horizontal = false
shader_parameter/pause_duration = 0.2
shader_parameter/texture_size = Vector2(16, 16)
shader_parameter/onoff = false
shader_parameter/vertical_gradient = ExtResource("9_pa2q0")
shader_parameter/color_gradient = ExtResource("8_mo3g1")

[sub_resource type="GDScript" id="GDScript_3yuga"]
script/source = "extends Trigger

var target: Node2D

func trigger(unit: Node):
	target = unit
	DialogueManager.dialogue_ended.connect(func(_res): SignalBus.reset.emit(), CONNECT_ONE_SHOT)
	DialogueManager.show_dialogue_balloon(preload(\"res://globals/dialogue/intro.dialogue\"), \"river\", [self])
	#Game.viewed_dialogue.append(\"river\")

func before_animation():
	var animation: AnimatedSprite2D = target.get_node(\"AnimatedSprite2D\")
	animation.stop()
	var tween = create_tween()
	tween.tween_callback(func (): animation.flip_h = true).set_delay(0.4)
	tween.tween_callback(func (): animation.flip_h = false).set_delay(0.2)
	tween.tween_interval(0.2)
	await tween.finished

func after_animation():
	var tween = create_tween()
	target.get_node(\"AnimatedSprite2D\").hide()
	target.get_node(\"Drowning\").show()
	tween.tween_property(target, \"position\", Vector2(target.position.x, get_viewport().get_visible_rect().size.y + Constants.TILE_SIZE*2), 0.3)
	await tween.finished
"

[sub_resource type="GDScript" id="GDScript_knweh"]
script/source = "extends Trigger


func trigger_effect(target: Node):
	print(\"level 1 complete\")
	SignalBus.level_complete.emit.call_deferred()
	queue_free()
	
	
"

[node name="Level1" type="Node2D"]
script = ExtResource("1_8tldk")
metadata/energy = 1

[node name="Path" type="Node2D" parent="."]

[node name="Marker2D" type="Marker2D" parent="Path"]
position = Vector2(264, 120)

[node name="Marker2D2" type="Marker2D" parent="Path"]
position = Vector2(168, 120)

[node name="Marker2D3" type="Marker2D" parent="Path"]
position = Vector2(136, 120)

[node name="Marker2D4" type="Marker2D" parent="Path"]
position = Vector2(8, 120)

[node name="Background" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("AAAAAAAAAQACAAAAAAAAAAEAAQAAAAAAAAAAAAIAAQABAAAAAAAAAAMAAQAAAAAAAAAAAAQAAQAAAAAAAAAAAAUAAQAAAAAAAAAAAAYAAQABAAAAAAAAAAcAAQAHAAMAAAAAAAgAAQAAAAAAAAAAAAkAAQAAAAAAAAAAAAoAAQAAAAAAAAAAAAsAAQABAAAAAAABAAAAAQAAAAAAAAABAAEAAgADAAAAAAABAAIAAgADAAMAAAABAAMAAgADAAMAAAABAAQAAgADAAEAAAABAAUAAQAAAAAAAAABAAYAAQABAAAAAAABAAcAAQAHAAMAAAABAAgAAQAAAAAAAAABAAkAAQABAAAAAAABAAoAAQABAAAAAAABAAsAAQABAAAAAAACAAAAAQABAAAAAAACAAEAAgABAAQAAAACAAIAAQAAAAAAAAACAAMAAQAAAAAAAAACAAQAAgAEAAAAAAACAAUAAgADAAMAAAACAAgAAgADAAMAAAACAAkAAgADAAMAAAACAAoAAgADAAMAAAACAAsAAgADAAMAAAADAAAAAQAAAAAAAAADAAEAAgABAAQAAAADAAIAAQAAAAAAAAADAAMAAQAAAAAAAAADAAQAAQABAAAAAAADAAUAAQABAAAAAAADAAYAAQACAAAAAAADAAcAAQAHAAMAAAADAAgAAQABAAAAAAADAAkAAQAAAAAAAAADAAoAAQABAAAAAAADAAsAAQAAAAAAAAAEAAAAAgADAAMAAAAEAAEAAgAEAAEAAAAEAAIAAQABAAAAAAAEAAMAAQAAAAAAAAAEAAQAAQAAAAEAAAAEAAUAAQAAAAMAAAAEAAYAAQAAAAAAAAAEAAcAAQAHAAMAAAAEAAgAAgAAAAAAAAAEAAkAAQAAAAAAAAAEAAoAAQAAAAAAAAAEAAsAAQAAAAAAAAAFAAAAAQAAAAAAAAAFAAEAAQAAAAAAAAAFAAIAAQAAAAAAAAAFAAMAAQAAAAEAAAAFAAQAAQADAAMAAAAFAAUAAQABAAMAAAAFAAYAAQAHAAMAAAAFAAcAAQAHAAMAAAAFAAgAAQAEAAQAAAAFAAkAAQAEAAUAAAAFAAoAAQAEAAYAAAAFAAsAAQAAAAAAAAAGAAAAAQAAAAAAAAAGAAEAAQAAAAAAAAAGAAIAAQAAAAAAAAAGAAMAAQACAAEAAAAGAAQAAQACAAIAAAAGAAUAAQACAAMAAAAGAAYAAQAAAAAAAAAGAAcAAQAHAAMAAAAGAAgAAQAHAAQAAAAGAAkAAQAFAAUAAAAGAAoAAQAFAAYAAAAGAAsAAQAAAAAAAAAHAAAAAQAAAAUAAAAHAAEAAQAAAAYAAAAHAAIAAQABAAAAAAAHAAMAAQAAAAAAAAAHAAQAAQAAAAAAAAAHAAUAAQAAAAAAAAAHAAYAAQABAAAAAAAHAAcAAQAHAAMAAAAHAAgAAQAFAAQAAAAHAAkAAQAHAAUAAAAHAAoAAAAAAAAAAAAHAAsAAQAAAAAAAAAIAAAAAQADAAUAAAAIAAEAAAAAAAAAAAAIAAIAAQAHAAMAAAAIAAMAAQAHAAMAAAAIAAQAAQAAAAAAAAAIAAUAAQABAAAAAAAIAAYAAQAAAAAAAAAIAAcAAQAHAAMAAAAIAAgAAQAGAAQAAAAIAAkAAQAGAAUAAAAIAAoAAQAHAAYAAAAIAAsAAQAAAAAAAAAJAAAAAQACAAUAAAAJAAEAAQADAAYAAAAJAAIAAQAAAAAAAAAJAAMAAQAHAAMAAAAJAAQAAQABAAAAAAAJAAUAAQAAAAAAAAAJAAYAAQABAAAAAAAJAAcAAQAHAAMAAAAJAAgAAQAAAAAAAAAJAAkAAQAAAAAAAAAJAAoAAQAAAAAAAAAJAAsAAQAAAAAAAAAKAAAAAQAAAAAAAAAKAAEAAQAAAAAAAAAKAAIAAQAAAAAAAAAKAAMAAQAHAAMAAAAKAAQAAQAHAAMAAAAKAAUAAQAHAAMAAAAKAAYAAQAHAAMAAAAKAAcAAQAHAAMAAAAKAAgAAQAAAAAAAAAKAAkAAQAAAAAAAAAKAAoAAQABAAAAAAAKAAsAAQAAAAAAAAALAAAAAQAAAAAAAAALAAEAAQABAAAAAAALAAIAAQAAAAAAAAALAAMAAQACAAAAAAALAAQAAQAHAAMAAAALAAUAAQAAAAAAAAALAAYAAQABAAAAAAALAAcAAQAHAAMAAAALAAgAAQAAAAAAAAALAAkAAQACAAAAAAALAAoAAQAAAAAAAAALAAsAAQAAAAAAAAAMAAAAAQAHAAMAAAAMAAEAAQAHAAMAAAAMAAIAAQAHAAMAAAAMAAMAAQAHAAMAAAAMAAQAAQAHAAMAAAAMAAUAAQAAAAAAAAAMAAYAAQABAAAAAAAMAAcAAQAHAAMAAAAMAAgAAQAAAAAAAAAMAAkAAQAAAAAAAAAMAAoAAQAAAAAAAAAMAAsAAQAAAAAAAAANAAAAAQAAAAAAAAANAAEAAQAAAAAAAAANAAIAAQAAAAAAAAANAAMAAQAAAAAAAAANAAQAAQAAAAAAAAANAAUAAQAAAAAAAAANAAYAAQAAAAAAAAANAAcAAQAHAAMAAAANAAgAAQABAAAAAAANAAkAAQAAAAAAAAANAAoAAQABAAAAAAANAAsAAQAAAAAAAAAOAAAAAQAAAAAAAAAOAAEAAQAAAAAAAAAOAAUAAQAAAAYAAAAOAAYAAQAAAAAAAAAOAAcAAQAHAAMAAAAOAAgAAQAAAAAAAAAOAAkAAQAAAAAAAAAOAAoAAQAAAAAAAAAOAAsAAQAAAAAAAAAPAAAAAQABAAAAAAAPAAEAAQABAAAAAAAPAAUAAQAAAAcAAAAPAAYAAQAAAAAAAAAPAAcAAQAHAAMAAAAPAAgAAQAAAAAAAAAPAAkAAQABAAAAAAAPAAoAAQABAAAAAAAPAAsAAQAAAAAAAAAQAAAAAQAAAAAAAAAQAAEAAQAAAAAAAAAQAAUAAAAAAAAAAAAQAAYAAQAHAAMAAAAQAAcAAQAHAAMAAAAQAAgAAQAAAAAAAAAQAAkAAQACAAAAAAAQAAoAAQAAAAAAAAAQAAsAAQAAAAAAAAARAAAAAQAAAAAAAAARAAEAAQABAAAAAAARAAUAAQADAAYAAAARAAYAAQAAAAAAAAARAAcAAQAAAAAAAAARAAgAAQAAAAAAAAARAAkAAQACAAAAAAARAAoAAQABAAAAAAARAAsAAQAAAAAAAAASAAAAAQAAAAAAAAASAAEAAQABAAAAAAASAAIAAQAAAAAAAAASAAQAAQAAAAAAAAASAAUAAQAAAAAAAAASAAYAAQAAAAAAAAASAAcAAQAAAAAAAAASAAgAAQABAAAAAAASAAkAAQAAAAAAAAASAAoAAQAAAAAAAAASAAsAAQAAAAAAAAATAAAAAQAAAAAAAAATAAEAAQABAAAAAAATAAIAAQAAAAAAAAATAAMAAQAAAAAAAAATAAQAAQACAAAAAAATAAUAAQAAAAAAAAATAAYAAQAAAAAAAAATAAcAAQAAAAAAAAATAAgAAQAAAAAAAAATAAkAAQABAAAAAAATAAoAAQAAAAAAAAATAAsAAQAAAAAAAAASAAMAAQAAAAAAAAAOAAIAAQABAAAAAAAPAAIAAQABAAAAAAAQAAIAAQACAAAAAAARAAIAAQAAAAAAAAAQAAQAAQADAAUAAAAPAAQAAQABAAUAAAAOAAQAAQAAAAUAAAAOAAMAAQAAAAQAAAAPAAMAAQADAAQAAAAQAAMAAQABAAQAAAARAAMAAQACAAQAAAARAAQAAQACAAUAAAACAAcABAAAAAAAAAACAAYAAwAAAAAAAAD//wwAAQAIAAQAAAD//wsAAQAIAAQAAAD//woAAQAIAAQAAAD//wkAAQAIAAQAAAD//wUAAQAIAAQAAAD//wgAAQAIAAQAAAD//wcAAQAIAAQAAAD//wYAAQAIAAQAAAD//wQAAQAIAAQAAAD//wMAAQAIAAQAAAD//wIAAQAIAAQAAAD//wEAAQAIAAQAAAD//wAAAQAIAAQAAAD/////AQAIAAQAAAAAAP//AQAIAAQAAAABAP//AQAIAAQAAAACAP//AQAIAAQAAAADAP//AQAIAAQAAAAEAP//AQAIAAQAAAAFAP//AQAIAAQAAAAGAP//AQAIAAQAAAAHAP//AQAIAAQAAAAIAP//AQAIAAQAAAAJAP//AQAIAAQAAAAKAP//AQAIAAQAAAALAP//AQAIAAQAAAAMAP//AQAIAAQAAAANAP//AQAIAAQAAAAOAP//AQAIAAQAAAAPAP//AQAIAAQAAAAQAP//AQAIAAQAAAARAP//AQAIAAQAAAASAP//AQAIAAQAAAATAP//AQAIAAQAAAAUAP//AQAIAAQAAAAUAAAAAQAIAAQAAAAUAAEAAQAIAAQAAAAUAAIAAQAIAAQAAAAUAAMAAQAIAAQAAAAUAAQAAQAIAAQAAAAUAAUAAQAIAAQAAAAUAAYAAQAIAAQAAAAUAAcAAQAIAAQAAAAUAAgAAQAIAAQAAAAUAAkAAQAIAAQAAAAUAAoAAQAIAAQAAAAUAAsAAQAIAAQAAAAUAAwAAQAIAAQAAAATAAwAAQAIAAQAAAASAAwAAQAIAAQAAAARAAwAAQAIAAQAAAAQAAwAAQAIAAQAAAAPAAwAAQAIAAQAAAAOAAwAAQAIAAQAAAANAAwAAQAIAAQAAAAMAAwAAQAIAAQAAAALAAwAAQAIAAQAAAAKAAwAAQAIAAQAAAAJAAwAAQAIAAQAAAAIAAwAAQAIAAQAAAAHAAwAAQAIAAQAAAAGAAwAAQAIAAQAAAAFAAwAAQAIAAQAAAAEAAwAAQAIAAQAAAADAAwAAQAIAAQAAAACAAwAAQAIAAQAAAABAAwAAQAIAAQAAAAAAAwAAQAIAAQAAAA=")
tile_set = ExtResource("1_ccbd7")

[node name="Environment" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("AAATAAUAAQAJAAMAAAASAAUAAQAIAAUAAAASAAQAAQAIAAQAAAASAAMAAQAIAAQAAAATAAIAAQAJAAMAAAASAAIAAQAIAAMAAAATAAMAAQAKAAcAAAAGAAEAAQAEAAEAAAAGAAAAAQAEAAAAAAAFAAEAAQAEAAEAAAAFAAAAAQAEAAAAAAASAAoAAQAEAAIAAAATAAoAAQAEAAIAAAASAAcAAQAFAAEAAAACAAMAAQAFAAEAAAADAAIAAQAFAAEAAAAQAAAAAQAEAAEAAAAOAAAAAQAEAAIAAAATAAAAAQAHAAEAAAASAAAAAQAHAAEAAAASAAEAAQAHAAIAAAATAAEAAQAHAAIAAAAPAAAAAQAEAAIAAAANAAEAAQAFAAEAAAAEAAoAAQAFAAEAAAARAAAAAQAGAAEAAAAOAAMAAQAAAAQAAAAPAAMAAQADAAQAAAAQAAMAAQABAAQAAAARAAMAAQACAAQAAAAHAAgAAQAFAAQAAAAFAAgAAQAEAAQAAAAGAAgAAQAHAAQAAAAIAAgAAQAGAAQAAAAAAAgAAQAIAAAAAAAAAAkAAQAHAAEAAAABAAkAAQAIAAEAAAAAAAoAAQAHAAEAAAABAAoAAQAIAAEAAAAAAAsAAQAIAAIAAAAOAAgAAQAJAAMAAAAMAAgAAQAIAAYAAAANAAgAAQAJAAYAAAAPAAgAAQAJAAYAAAAQAAgAAQAJAAMAAAARAAgAAQAJAAYAAAASAAgAAQAKAAYAAAAFAAQAAQAIAAgAAAAFAAMAAQAIAAcAAAAFAAUAAQAKAAoAAAAEAAgAAQAEAAIAAAAQAAUAAQACAAYAAAAIAAEAAQABAAcAAAAHAAoAAQAFAAcAAAA=")
tile_set = ExtResource("1_ccbd7")

[node name="Hauntable" type="Node2D" parent="."]

[node name="Sign" parent="Hauntable" instance=ExtResource("2_wjbil")]
position = Vector2(152, 104)

[node name="DialogueTrigger" parent="Hauntable/Sign" node_paths=PackedStringArray("targets") instance=ExtResource("3_7si14")]
position = Vector2(16, 0)
dialogue_resource = ExtResource("4_owc7f")
title = "sign"
targets = [NodePath("../../../Characters/Timmy")]

[node name="Bush" parent="Hauntable" instance=ExtResource("3_lkic7")]
position = Vector2(200, 88)

[node name="Bush2" parent="Hauntable" instance=ExtResource("3_lkic7")]
material = SubResource("ShaderMaterial_vqgqp")
position = Vector2(216, 88)

[node name="Wheelbarrow" parent="Hauntable" instance=ExtResource("4_74al4")]
position = Vector2(56, 136)

[node name="Wheelbarrow2" parent="Hauntable" instance=ExtResource("4_74al4")]
material = SubResource("ShaderMaterial_rw3kd")
position = Vector2(152, 168)

[node name="Characters" type="Node2D" parent="."]

[node name="Timmy" parent="Characters" node_paths=PackedStringArray("path") instance=ExtResource("4_475vb")]
position = Vector2(264, 104)
path = NodePath("../../Path")

[node name="Ghost" parent="." node_paths=PackedStringArray("target") instance=ExtResource("8_8j1tp")]
position = Vector2(280, 104)
target = NodePath("../Characters/Timmy")

[node name="Foreground" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("AAAOAAMAAQAAAAQAAAAOAAQAAQAAAAUAAAAPAAMAAQADAAQAAAAQAAQAAQADAAUAAAAPAAQAAQABAAUAAAAQAAMAAQABAAQAAAARAAMAAQACAAQAAAARAAQAAQACAAUAAAAFAAgAAQAEAAQAAAAGAAgAAQAHAAQAAAAHAAgAAQAFAAQAAAAIAAgAAQAGAAQAAAAEAAoAAQAFAAEAAAANAAEAAQAFAAEAAAADAAIAAQAFAAEAAAACAAMAAQAFAAEAAAASAAcAAQAFAAEAAAA=")
tile_set = ExtResource("1_ccbd7")

[node name="Triggers" type="Node2D" parent="."]

[node name="RiverTrigger" parent="Triggers" instance=ExtResource("7_k4aph")]
position = Vector2(40, 120)
script = SubResource("GDScript_3yuga")
targets = Array[Node]([null])

[node name="EndTrigger" parent="Triggers" node_paths=PackedStringArray("targets") instance=ExtResource("7_k4aph")]
position = Vector2(8, 120)
script = SubResource("GDScript_knweh")
targets = [NodePath("../../Characters/Timmy")]
