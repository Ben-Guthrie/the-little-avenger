[gd_scene load_steps=18 format=4 uid="uid://cm5mb46hc8s2w"]

[ext_resource type="Script" path="res://levels/level_3.gd" id="1_t28vs"]
[ext_resource type="TileSet" uid="uid://bpqj3wfubuunh" path="res://assets/town_tileset.tres" id="2_xnwxc"]
[ext_resource type="PackedScene" uid="uid://blasv8il4wied" path="res://environment/Bomb.tscn" id="3_myx4t"]
[ext_resource type="PackedScene" uid="uid://scpge4df51ca" path="res://environment/chest.tscn" id="4_fenkb"]
[ext_resource type="PackedScene" uid="uid://3bar45d4qj4m" path="res://characters/warrior.tscn" id="5_iosi3"]
[ext_resource type="Shader" path="res://shaders/haunt-outline.gdshader" id="7_44ioi"]
[ext_resource type="PackedScene" uid="uid://dolou4guv44a3" path="res://characters/archer.tscn" id="7_hb46g"]
[ext_resource type="PackedScene" uid="uid://1m2umsuy8oo5" path="res://triggers/trigger.tscn" id="7_nj7p8"]
[ext_resource type="Texture2D" uid="uid://fn7hcj6iq0jh" path="res://shaders/color_gradient_texture_1d.tres" id="8_8etxi"]
[ext_resource type="Texture2D" uid="uid://caqsdsty08tfr" path="res://shaders/vertical_gradient_texture_1d.tres" id="9_3deqi"]
[ext_resource type="PackedScene" uid="uid://cqx28vp8kokba" path="res://characters/timmy.tscn" id="13_40l2q"]
[ext_resource type="PackedScene" uid="uid://cycr7ijppuaug" path="res://characters/ghost.tscn" id="14_42hdc"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_2xw4r"]
shader = ExtResource("7_44ioi")
shader_parameter/size_effect = 12.0
shader_parameter/speed = 1.2
shader_parameter/highlight_strength = 0.5
shader_parameter/color_mode_toggle = true
shader_parameter/is_horizontal = false
shader_parameter/pause_duration = 0.2
shader_parameter/texture_size = Vector2(16, 16)
shader_parameter/onoff = false
shader_parameter/vertical_gradient = ExtResource("9_3deqi")
shader_parameter/color_gradient = ExtResource("8_8etxi")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_jlu3l"]
shader = ExtResource("7_44ioi")
shader_parameter/size_effect = 12.0
shader_parameter/speed = 1.2
shader_parameter/highlight_strength = 0.5
shader_parameter/color_mode_toggle = true
shader_parameter/is_horizontal = false
shader_parameter/pause_duration = 0.2
shader_parameter/texture_size = Vector2(16, 16)
shader_parameter/onoff = false
shader_parameter/vertical_gradient = ExtResource("9_3deqi")
shader_parameter/color_gradient = ExtResource("8_8etxi")

[sub_resource type="GDScript" id="GDScript_a6lyq"]
script/source = "extends Trigger


func trigger_effect(target: Node):
	print(\"level 2 complete\")
	SignalBus.level_complete.emit()
	queue_free()
"

[sub_resource type="GDScript" id="GDScript_bhjcj"]
script/source = "extends Trigger


func trigger_effect(target):
	print(\"chest triggered\")
	if \"path\" in target:
		if target.has_meta(\"is_timmy\"):
			print(\"is timmy\")
			SignalBus.trigger_dialogue.emit(\"chest\")
			await SignalBus.dialogue_triggered
		var marker = Marker2D.new()
		marker.global_position = get_parent().get_parent().global_position
		target.path.add_child(marker)
		target.path.move_child(marker, 0)
		complete.emit.call_deferred()
		print(\"complete\")
	else:
		complete.emit()
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_6vb1o"]
size = Vector2(16, 16)

[node name="Level3" type="Node2D"]
script = ExtResource("1_t28vs")
energy = 2

[node name="Background" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("AAD//woAAQAIAAQAAAD//wkAAQAIAAQAAAD//wgAAQAIAAQAAAD//wUAAQAIAAQAAAD//wQAAQAIAAQAAAD//wcAAQAIAAQAAAD//wYAAQAKAAQAAAD//wMAAQAIAAQAAAD//wIAAQAIAAQAAAD//wEAAQAIAAQAAAD//wAAAQAIAAQAAAD//wsAAQAIAAQAAAD//wwAAQAIAAQAAAAAAAwAAQAIAAQAAAABAAwAAQAIAAQAAAACAAwAAQAIAAQAAAADAAwAAQAIAAQAAAAEAAwAAQAIAAQAAAAFAAwAAQAIAAQAAAAGAAwAAQAIAAQAAAAHAAwAAQAIAAQAAAAIAAwAAQAIAAQAAAAJAAwAAQAIAAQAAAAKAAwAAQAIAAQAAAALAAwAAQAIAAQAAAAMAAwAAQAIAAQAAAANAAwAAQAIAAQAAAAOAAwAAQAIAAQAAAAPAAwAAQAIAAQAAAAQAAwAAQAIAAQAAAARAAwAAQAIAAQAAAASAAwAAQAIAAQAAAATAAwAAQAIAAQAAAAUAAwAAQAIAAQAAAAUAAsAAQAIAAQAAAAUAAoAAQAIAAQAAAAUAAkAAQAIAAQAAAAUAAgAAQAIAAQAAAAUAAcAAQAIAAQAAAAUAAYAAQAIAAQAAAAUAAUAAQAIAAQAAAAUAAQAAQAIAAQAAAAUAAMAAQAIAAQAAAAUAAIAAQAIAAQAAAAUAAEAAQAIAAQAAAAUAAAAAQAIAAQAAAAUAP//AQAIAAQAAAATAP//AQAKAAQAAAASAP//AQAKAAQAAAARAP//AQAKAAQAAAAQAP//AQAKAAQAAAAPAP//AQAKAAQAAAAOAP//AQAKAAQAAAANAP//AQAKAAQAAAAMAP//AQAKAAQAAAALAP//AQAKAAQAAAAKAP//AQAKAAQAAAAJAP//AQAKAAQAAAAIAP//AQAKAAQAAAAHAP//AQAKAAQAAAAGAP//AQAKAAQAAAAFAP//AQAKAAQAAAAEAP//AQAKAAQAAAADAP//AQAKAAQAAAACAP//AQAKAAQAAAABAP//AQAKAAQAAAAAAP//AQAKAAQAAAD/////AQAIAAQAAAAAAAAAAAABAAQAAAAAAAEAAAAAAAQAAAAAAAIAAAAAAAQAAAAAAAMAAAAAAAQAAAAAAAQAAAABAAQAAAAAAAUAAAAAAAQAAAAAAAYAAAACAAQAAAAAAAcAAAABAAQAAAAAAAgAAAAAAAQAAAAAAAkAAAABAAQAAAAAAAoAAAAAAAQAAAABAAAAAAAAAAQAAAABAAEAAAAAAAQAAAABAAIAAAAAAAQAAAABAAMAAAAAAAQAAAABAAQAAAAAAAQAAAABAAUAAAAAAAQAAAABAAYAAAADAAQAAAABAAcAAAAGAAMAAAABAAgAAAAAAAQAAAABAAkAAAAAAAQAAAABAAoAAAAAAAQAAAACAAAAAAAAAAQAAAACAAEAAAAAAAQAAAACAAIAAAAAAAQAAAACAAMAAAABAAQAAAACAAQAAAAAAAQAAAACAAUAAAAAAAQAAAACAAYAAAACAAQAAAACAAcAAAAGAAMAAAACAAgAAAAAAAQAAAACAAkAAAAAAAQAAAACAAoAAAAAAAQAAAADAAAAAAAAAAQAAAADAAEAAAABAAQAAAADAAIAAAAAAAQAAAADAAMAAAAAAAQAAAADAAQAAAAAAAQAAAADAAUAAAAAAAQAAAADAAYAAAACAAQAAAADAAcAAAAGAAMAAAADAAgAAAAAAAQAAAADAAkAAAAAAAQAAAADAAoAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAEAAAAAAAQAAAAEAAIAAAAAAAQAAAAEAAMAAAABAAQAAAAEAAQAAAAAAAQAAAAEAAUAAAAAAAQAAAAEAAYAAAAAAAQAAAAEAAcAAAAAAAQAAAAEAAgAAAAAAAQAAAAEAAkAAAAAAAQAAAAEAAoAAAAAAAQAAAAFAAAAAAAAAAQAAAAFAAEAAAAAAAQAAAAFAAIAAAAAAAQAAAAFAAMAAAAAAAQAAAAFAAQAAAAAAAQAAAAFAAUAAAABAAQAAAAFAAYAAAAAAAQAAAAFAAcAAAABAAQAAAAFAAgAAAAAAAQAAAAFAAkAAAAAAAQAAAAFAAoAAAABAAQAAAAGAAAAAAAAAAQAAAAGAAEAAAAAAAQAAAAGAAIAAAAAAAQAAAAGAAMAAAABAAQAAAAGAAQAAAAAAAQAAAAGAAUAAAAAAAQAAAAGAAYAAAABAAQAAAAGAAcAAAAGAAMAAAAGAAgAAAAAAAQAAAAGAAkAAAAAAAQAAAAGAAoAAAAAAAQAAAAHAAAAAAAAAAQAAAAHAAEAAAAAAAQAAAAHAAIAAAAAAAQAAAAHAAMAAAABAAQAAAAHAAQAAAAAAAQAAAAHAAUAAAAAAAQAAAAHAAYAAAAAAAQAAAAHAAcAAAAGAAMAAAAHAAgAAAAAAAQAAAAHAAkAAAAAAAQAAAAHAAoAAAAAAAQAAAAIAAAAAAAAAAQAAAAIAAEAAAAAAAQAAAAIAAIAAAAAAAQAAAAIAAMAAAABAAQAAAAIAAQAAAAAAAQAAAAIAAUAAAAAAAQAAAAIAAYAAAABAAQAAAAIAAcAAAAAAAQAAAAIAAgAAAAAAAQAAAAIAAkAAAAAAAQAAAAIAAoAAAAAAAQAAAAJAAAAAAAEAAAAAAAJAAEAAAADAAEAAAAJAAIAAAAEAAEAAAAJAAMAAAAJAAQAAAAJAAUAAAACAAQAAAAJAAYAAAAAAAQAAAAJAAcAAAAGAAMAAAAJAAgAAAAAAAQAAAAJAAkAAAAAAAQAAAAJAAoAAAAAAAQAAAAKAAAAAAACAAIAAAAKAAEAAAAAAAAAAAAKAAIAAAACAAAAAAAKAAMAAAAEAAMAAAAKAAUAAAACAAQAAAAKAAYAAAAGAAMAAAAKAAcAAAAGAAMAAAAKAAgAAAAAAAQAAAAKAAkAAAAEAAAAAAAKAAoAAAADAAEAAAALAAAAAAACAAIAAAALAAEAAAAAAAAAAAALAAIAAAACAAAAAAALAAMAAAAJAAEAAAALAAQAAAADAAMAAAALAAUAAAACAAQAAAALAAcAAAAAAAQAAAALAAgAAAAAAAQAAAALAAkAAAACAAIAAAALAAoAAAAAAAAAAAAMAAAAAAACAAIAAAAMAAEAAAAAAAAAAAAMAAIAAAACAAAAAAAMAAMAAAAEAAMAAAAMAAUAAAACAAQAAAAMAAYAAAAGAAMAAAAMAAcAAAAAAAQAAAAMAAgAAAAEAAAAAAAMAAkAAAADAAIAAAANAAAAAAACAAIAAAANAAEAAAAAAAEAAAANAAIAAAACAAAAAAANAAMAAAAEAAIAAAANAAUAAAADAAQAAAANAAYAAAAGAAMAAAANAAcAAAABAAQAAAANAAgAAAACAAIAAAANAAkAAAAAAAAAAAANAAoAAAABAAAAAAAOAAAAAAACAAIAAAAOAAEAAAAAAAAAAAAOAAIAAAACAAAAAAAOAAMAAAAFAAIAAAAOAAUAAAACAAQAAAAOAAYAAAAAAAQAAAAOAAcAAAAAAAQAAAAOAAgAAAACAAIAAAAOAAkAAAAAAAAAAAAOAAoAAAACAAAAAAAPAAAAAAAFAAAAAAAPAAEAAAABAAEAAAAPAAIAAAAFAAEAAAAPAAMAAAALAAQAAAAPAAUAAAADAAQAAAAPAAYAAAAGAAMAAAAPAAcAAAABAAQAAAAPAAgAAAACAAIAAAAPAAkAAAAAAAAAAAAPAAoAAAACAAAAAAAQAAAAAAABAAQAAAAQAAEAAAAAAAQAAAAQAAIAAAAAAAQAAAAQAAMAAAAAAAQAAAAQAAQAAAABAAQAAAAQAAUAAAAAAAQAAAAQAAYAAAAGAAMAAAAQAAcAAAAAAAQAAAAQAAgAAAACAAIAAAAQAAkAAAAAAAAAAAAQAAoAAAACAAAAAAARAAAAAAAAAAQAAAARAAEAAAAAAAQAAAARAAIAAAAAAAQAAAARAAMAAAAAAAQAAAARAAQAAAAAAAQAAAARAAUAAQAFAAMAAAARAAYAAAAGAAMAAAARAAcAAQAEAAMAAAARAAgAAAAFAAAAAAARAAkAAAABAAEAAAARAAoAAAAFAAEAAAASAAAAAAAAAAQAAAASAAEAAAAAAAQAAAASAAIAAAAAAAQAAAASAAMAAAAAAAQAAAASAAQAAAAAAAQAAAASAAUAAQABAAMAAAASAAYAAQAHAAMAAAASAAcAAQABAAEAAAASAAgAAAAAAAQAAAASAAkAAAAAAAQAAAASAAoAAAAAAAQAAAATAAAAAAABAAQAAAATAAEAAAAAAAQAAAATAAIAAAABAAQAAAATAAMAAAAAAAQAAAATAAQAAQAFAAMAAAATAAUAAQACAAMAAAATAAYAAQAHAAMAAAATAAcAAQABAAEAAAATAAgAAAABAAQAAAATAAkAAAABAAQAAAATAAoAAAABAAQAAAATAAsAAAAAAAQAAAASAAsAAAABAAQAAAARAAsAAAALAAQAAAAQAAsAAAAEAAMAAAAPAAsAAAAEAAIAAAAOAAsAAAAEAAMAAAANAAsAAAABAAEAAAAMAAsAAAAAAAAAAAALAAsAAAAAAAAAAAAKAAsAAAADAAEAAAAJAAsAAAAAAAQAAAAIAAsAAAAAAAQAAAAHAAsAAAAAAAQAAAAGAAsAAAAAAAQAAAAFAAsAAAAAAAQAAAAEAAsAAAAAAAQAAAADAAsAAAAAAAQAAAACAAsAAAAAAAQAAAABAAsAAAABAAQAAAAAAAsAAAAAAAQAAAAMAAQAAAACAAEAAAANAAQAAAAEAAMAAAAOAAQAAAACAAEAAAAPAAQAAAALAAQAAAAJAAQAAAAJAAQAAAAKAAQAAAACAAEAAAALAAYAAAABAAQAAAAMAAoAAAAAAAAAAAA=")
tile_set = ExtResource("2_xnwxc")

[node name="Environment" type="TileMapLayer" parent="."]
tile_map_data = PackedByteArray("AAASAAIAAAAAAAYAAAATAAIAAAABAAYAAAASAAEAAAABAAYAAAAHAAgAAAAFAAYAAAAGAAgAAAAEAAYAAAAIAAgAAAAGAAYAAAAEAAgAAAAGAAYAAAADAAgAAAAFAAYAAAACAAgAAAAEAAYAAAAGAAsAAAAGAAUAAAAIAAsAAAAGAAUAAAAEAAsAAAAGAAUAAAACAAsAAAAGAAUAAAACAAoAAAAEAAUAAAAGAAoAAAAEAAUAAAAIAAoAAAAEAAUAAAAEAAoAAAAFAAUAAAACAAUAAAAJAAMAAAADAAUAAAALAAQAAAAAAAUAAAAJAAQAAAABAAUAAAAEAAMAAAABAAQAAAACAAAAAAACAAQAAAACAAAAAAAAAAQAAAAEAAEAAAADAAQAAAAFAAEAAAAAAAMAAAADAAEAAAAAAAIAAAADAAEAAAAAAAEAAAAEAAAAAAABAAEAAAACAAIAAAACAAEAAAACAAIAAAADAAEAAAACAAIAAAAEAAEAAAACAAIAAAAFAAEAAAAFAAAAAAAFAAMAAAAFAAEAAAADAAMAAAABAAAAAAAEAAMAAAACAAAAAAAFAAIAAAABAAEAAAAEAAIAAAAAAAAAAAADAAIAAAAAAAAAAAACAAIAAAAAAAAAAAABAAIAAAAAAAEAAAABAAMAAAAAAAAAAAACAAMAAAAAAAAAAAAEAAQAAAAEAAMAAAAFAAQAAAALAAQAAAAHAAAAAAACAAYAAAAHAAEAAAABAAYAAAAIAAEAAAAGAAgAAAAAAAAAAAADAAUAAAABAAAAAAADAAUAAAA=")
tile_set = ExtResource("2_xnwxc")

[node name="Hauntable" type="Node2D" parent="."]

[node name="Bomb" parent="Hauntable" instance=ExtResource("3_myx4t")]
position = Vector2(248, 88)

[node name="Chest" parent="Hauntable" instance=ExtResource("4_fenkb")]
position = Vector2(104, 72)

[node name="Chest2" parent="Hauntable" instance=ExtResource("4_fenkb")]
material = SubResource("ShaderMaterial_2xw4r")
position = Vector2(152, 168)

[node name="Characters" type="Node2D" parent="."]

[node name="Timmy" parent="Characters" node_paths=PackedStringArray("path") instance=ExtResource("13_40l2q")]
position = Vector2(296, 104)
path = NodePath("../../Paths/Timmy")

[node name="Warrior" parent="Characters" node_paths=PackedStringArray("path") instance=ExtResource("5_iosi3")]
position = Vector2(184, 56)
path = NodePath("../../Paths/Warrior")

[node name="Warrior2" parent="Characters" instance=ExtResource("5_iosi3")]
material = SubResource("ShaderMaterial_jlu3l")
position = Vector2(104, 104)

[node name="Archer" parent="Characters" instance=ExtResource("7_hb46g")]
position = Vector2(136, 72)

[node name="Ghost" parent="." node_paths=PackedStringArray("target") instance=ExtResource("14_42hdc")]
position = Vector2(312, 112)
target = NodePath("../Characters/Timmy")

[node name="Foreground" type="TileMapLayer" parent="."]
tile_set = ExtResource("2_xnwxc")

[node name="Triggers" type="Node2D" parent="."]

[node name="EndTrigger" parent="Triggers" node_paths=PackedStringArray("targets") instance=ExtResource("7_nj7p8")]
position = Vector2(8, 120)
script = SubResource("GDScript_a6lyq")
targets = [NodePath("../../Characters/Timmy")]

[node name="Paths" type="Node2D" parent="."]

[node name="Timmy" type="Node2D" parent="Paths"]

[node name="Marker2D" type="Marker2D" parent="Paths/Timmy"]
position = Vector2(168, 104)

[node name="Marker2D2" type="Marker2D" parent="Paths/Timmy"]
position = Vector2(168, 120)

[node name="Marker2D4" type="Marker2D" parent="Paths/Timmy"]
position = Vector2(8, 120)

[node name="Warrior" type="Node2D" parent="Paths"]

[node name="Marker2D" type="Marker2D" parent="Paths/Warrior"]
position = Vector2(184, 104)

[node name="Trigger" parent="." instance=ExtResource("7_nj7p8")]
position = Vector2(0, 16)
script = SubResource("GDScript_bhjcj")

[node name="CollisionShape2D" parent="Trigger" index="0"]
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Trigger"]
position = Vector2(0, 16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D3" type="CollisionShape2D" parent="Trigger"]
position = Vector2(0, 32)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D4" type="CollisionShape2D" parent="Trigger"]
position = Vector2(16, -16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D5" type="CollisionShape2D" parent="Trigger"]
position = Vector2(32, -16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D6" type="CollisionShape2D" parent="Trigger"]
position = Vector2(48, -16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D7" type="CollisionShape2D" parent="Trigger"]
position = Vector2(0, -32)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D8" type="CollisionShape2D" parent="Trigger"]
position = Vector2(0, -48)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D9" type="CollisionShape2D" parent="Trigger"]
position = Vector2(0, -64)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D10" type="CollisionShape2D" parent="Trigger"]
position = Vector2(-16, -16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D11" type="CollisionShape2D" parent="Trigger"]
position = Vector2(-32, -16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="CollisionShape2D12" type="CollisionShape2D" parent="Trigger"]
position = Vector2(-48, -16)
shape = SubResource("RectangleShape2D_6vb1o")

[node name="LevelStartTimer" type="Timer" parent="."]
wait_time = 0.5

[connection signal="timmy_dies" from="Characters/Timmy" to="." method="_on_timmy_timmy_dies"]

[editable path="Trigger"]
